# Spring Boot 应用配置
spring:
  application:
    name: dify-ingest
  
  # 数据库配置
  datasource:
    url: jdbc:postgresql://172.24.0.5:5432/dify
    username: postgres
    password: difyai123456
    driver-class-name: org.postgresql.Driver
  
  # JPA 配置
  jpa:
    show-sql: false
    hibernate:
      ddl-auto: none

# 服务端口
server:
  port: 8080

# 应用配置
app:
  # Dify API 配置
  dify:
    api-key: ${DIFY_API_KEY:dataset-CxGlfh0xHkUoCts6dj17XUhw}  # Dify API 密钥
    base-url: ${DIFY_BASE_URL:http://172.24.0.5/v1}            # Dify API 地址
  
  # MinerU 服务配置
  mineru:
    base-url: ${MINERU_BASE_URL:http://172.24.0.5:8000}        # MinerU 服务地址
    server-type: ${MINERU_SERVER_TYPE:local}                   # 服务类型: local 或 remote
    token: ${MINERU_TOKEN:}                                    # 远程服务 token（可选）
    parse-method: auto                                         # 解析方法: auto, ocr, txt
    backend: pipeline                                          # 解析后端: pipeline, vlm-transformers 等
    enable-formula: true                                       # 是否启用公式识别
    enable-table: true                                         # 是否启用表格识别
    language: ch                                               # 文档语言: ch, en 等
  
  # MinIO 配置
  minio:
    img-path-prefix: ${MINIO_IMG_PREFIX:http://172.24.0.5:9000/ty-ai-flow}  # 图片路径前缀
  
  # 文档分段规则配置（AUTO 模式下根据知识库类型自动匹配）
  process-rule:
    # 文本模型配置
    text-model:
      separator: "\n"           # 分段分隔符
      max-tokens: 1000          # 最大 token 数
      chunk-overlap: 50         # 分段重叠
    
    # 层级模型（父子结构）配置
    hierarchical-model:
      separator: "{{>1#}}"      # 父分段分隔符
      max-tokens: 1024          # 父分段最大 token 数
      sub-separator: "{{>2#}}"  # 子分段分隔符
      sub-max-tokens: 512       # 子分段最大 token 数
      chunk-overlap: 50         # 分段重叠 token 数
      parent-mode: paragraph    # 父分段模式
    
    # Q&A 模型配置
    qa-model:
      enabled: false            # 是否启用
  
  # VLM 视觉模型配置
  vlm:
    provider: ${VLM_PROVIDER:ollama}                                       # 提供商: openai, qwen, modelverse, ollama
    base-url: ${VLM_BASE_URL:http://172.24.0.5:11434/api/chat}            # VLM API 地址
    api-key: ${VLM_API_KEY:}                                               # VLM API 密钥（Ollama 不需要）
    model: ${VLM_MODEL:qwen2.5vl:7b}                                       # 模型名称
    max-tokens: 10000                                                      # 最大 token 数
    prompt: "请简要描述这张图片的主要内容（100字以内），并提取图片中的关键文字。格式：描述: （简要描述） OCR: （关键文字）"

# 日志配置
logging:
  level:
    com.example.ingest: DEBUG  # 应用日志级别
